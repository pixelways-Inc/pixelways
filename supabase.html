<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Supabase Public Upload Test</title>
</head>
<body>
  <h2>Upload to Supabase Public Bucket</h2>
  <input type="file" id="fileInput" />
  <button id="uploadBtn">Upload</button>
  <p id="status"></p>

  <!-- Load Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.4/dist/umd/supabase.min.js"></script>
  
  <script>
    const supabaseUrl = "https://dlunpilhklsgvkegnnlp.supabase.co";
    const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsdW5waWxoa2xzZ3ZrZWdubmxwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwNTA0MTksImV4cCI6MjA3MDYyNjQxOX0.rhLN_bhvH9IWPkyHiohrOQbY9D34RSeSLzURhAyZPds";

    // Correctly initialize the client AFTER loading script
    const client = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

    document.getElementById("uploadBtn").addEventListener("click", async () => {
      const file = document.getElementById("fileInput").files[0];
      if (!file) {
        alert("Please select a file");
        return;
      }

      document.getElementById("status").innerText = "Uploading...";

      const filePath = `uploads/${Date.now()}-${file.name}`;
      const { data, error } = await client.storage
        .from("quotes")
        .upload(filePath, file, { cacheControl: "3600", upsert: false });

      if (error) {
        console.error(error);
        document.getElementById("status").innerText = "❌ Upload failed";
      } else {
        const { data: publicData } = client.storage.from("quotes").getPublicUrl(filePath);
        document.getElementById("status").innerHTML =
          `✅ Uploaded! <a href="${publicData.publicUrl}" target="_blank">View File</a>`;
      }
    });
  </script>
</body>
</html>
